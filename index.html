<!DOCTYPE html>  <html> <head>   <title>mojo.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               mojo.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p><strong>mojo</strong> - a MongoDB job queue</p>

<p>Jobs are stored in a collection and retreived or updated using the
findAndModify command. This allows multiple workers to concurrently
access the queue. Each job has an expiration date, and once acquired by
a worker, also a timeout. Old jobs and stuck workers can so be identified
and dealed with appropriately.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <h3>Connection</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Mojo is backed by MongoDB</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">mongodb = </span><span class="nx">require</span> <span class="s1">&#39;mongodb&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>The <strong>Connection</strong> class wraps the connection to MongoDB. It includes
methods to manipulate (add, remove, clear, ...) jobs in the queues.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">exports</span><span class="p">.</span><span class="nx">Connection</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Initialize with a reference to the MongoDB and optional options
hash. Two opitions are currently supported: expires and timeout.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">constructor: </span><span class="nf">(options) -&gt;</span>
    <span class="nx">options</span> <span class="o">or</span> <span class="nv">options = </span><span class="p">{}</span>
    <span class="nx">@ensureConnection</span> <span class="nx">options</span>

    <span class="vi">@expires = </span><span class="nx">options</span><span class="p">.</span><span class="nx">expires</span> <span class="o">or</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">1000</span>
    <span class="vi">@timeout = </span><span class="nx">options</span><span class="p">.</span><span class="nx">timeout</span> <span class="o">or</span> <span class="mi">10</span> <span class="o">*</span> <span class="mi">1000</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Open a connection to the MongoDB server. Queries created while we are
connecting are queued and executed after the connection is established.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">ensureConnection: </span><span class="nf">(opt) -&gt;</span>
    <span class="vi">@queue = </span><span class="p">[]</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>TODO: support replica sets</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">server = </span><span class="k">new</span> <span class="nx">mongodb</span><span class="p">.</span><span class="nx">Server</span> <span class="nx">opt</span><span class="p">.</span><span class="nx">host</span> <span class="o">||</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="nx">opt</span><span class="p">.</span><span class="nx">port</span> <span class="o">||</span> <span class="mi">27017</span>
    <span class="k">new</span> <span class="nx">mongodb</span><span class="p">.</span><span class="nx">Db</span><span class="p">(</span><span class="nx">opt</span><span class="p">.</span><span class="nx">db</span> <span class="o">||</span> <span class="s1">&#39;queue&#39;</span><span class="p">,</span> <span class="nx">server</span><span class="p">,</span> <span class="p">{}).</span><span class="nx">open</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">db</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span> <span class="nx">err</span> <span class="k">if</span> <span class="nx">err</span>

      <span class="nv">afterConnectionEstablished = </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span> <span class="nx">err</span> <span class="k">if</span> <span class="nx">err</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Make a lame read request to the database. This will return an error
if the client is not authorized to access it.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">db</span><span class="p">.</span><span class="nx">collectionNames</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="o">=&gt;</span>
          <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span> <span class="nx">err</span> <span class="k">if</span> <span class="nx">err</span>

          <span class="nx">db</span><span class="p">.</span><span class="nx">collection</span> <span class="s1">&#39;mojo&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">collection</span><span class="p">)</span> <span class="o">=&gt;</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span> <span class="nx">err</span> <span class="k">if</span> <span class="nx">err</span>

            <span class="vi">@mojo = </span><span class="nx">collection</span>
            <span class="nx">fn</span><span class="p">(</span><span class="nx">collection</span><span class="p">)</span> <span class="k">for</span> <span class="nx">fn</span> <span class="k">in</span> <span class="nx">@queue</span> <span class="k">if</span> <span class="nx">@queue</span>
            <span class="k">delete</span> <span class="nx">@queue</span>

            <span class="nx">collection</span><span class="p">.</span><span class="nx">ensureIndex</span> <span class="p">[</span> <span class="p">[</span><span class="s1">&#39;queue&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;expires&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;owner&#39;</span><span class="p">]</span> <span class="p">],</span> <span class="o">-&gt;</span>

      <span class="k">if</span> <span class="nx">opt</span><span class="p">.</span><span class="nx">username</span> <span class="o">and</span> <span class="nx">opt</span><span class="p">.</span><span class="nx">password</span>
        <span class="nx">db</span><span class="p">.</span><span class="nx">authenticate</span> <span class="nx">opt</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span> <span class="nx">opt</span><span class="p">.</span><span class="nx">password</span><span class="p">,</span> <span class="nx">afterConnectionEstablished</span>
      <span class="k">else</span>
        <span class="nx">afterConnectionEstablished</span> <span class="kc">null</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Execute the given function if the connection to the database has been
established. If not, put it into a queue so it can be executed later.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">exec: </span><span class="nf">(fn) -&gt;</span>
    <span class="nx">@queue</span> <span class="o">and</span> <span class="nx">@queue</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">fn</span><span class="p">)</span> <span class="o">or</span> <span class="nx">fn</span><span class="p">(</span><span class="nx">@mojo</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Remove all jobs from the queue. This is a brute-force method, useful if
you want to reset mojo, for example in a test environment. Note that it
resets only a single queue, and not all.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">clear: </span><span class="nf">(queue, callback) -&gt;</span>
    <span class="nx">@exec</span> <span class="nf">(mojo) -&gt;</span>
      <span class="nx">mojo</span><span class="p">.</span><span class="nx">remove</span> <span class="p">{</span> <span class="nx">queue</span> <span class="p">},</span> <span class="nx">callback</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Insert a new job into the queue. A job is just an array of arguments
which are inserted into a queue. What these arguments mean is entirely
up to the individual workers.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">enqueue: </span><span class="nf">(queue, args..., callback)-&gt;</span>
    <span class="nv">expires = </span><span class="k">new</span> <span class="nb">Date</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">()</span> <span class="o">+</span> <span class="nx">@expires</span>
    <span class="nx">@exec</span> <span class="nf">(mojo) -&gt;</span>
      <span class="nx">mojo</span><span class="p">.</span><span class="nx">insert</span> <span class="p">{</span> <span class="nx">queue</span><span class="p">,</span> <span class="nx">expires</span><span class="p">,</span> <span class="nx">args</span> <span class="p">},</span> <span class="nx">callback</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Fetch the next job from the queue. The owner argument is used to identify
the worker which acquired the job. If you use a combination of hostname
and process ID, you can later identify stuck workers.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">next: </span><span class="nf">(queue, owner, callback) -&gt;</span>
    <span class="nv">now = </span><span class="k">new</span> <span class="nb">Date</span><span class="p">;</span> <span class="nv">timeout = </span><span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">now</span><span class="p">.</span><span class="nx">getTime</span><span class="p">()</span> <span class="o">+</span> <span class="nx">@timeout</span><span class="p">)</span>
    <span class="nx">@exec</span> <span class="nf">(mojo) -&gt;</span>
      <span class="nx">mojo</span><span class="p">.</span><span class="nx">findAndModify</span> <span class="p">{</span> <span class="nx">queue</span><span class="p">,</span> <span class="nv">expires: </span><span class="p">{</span> <span class="nv">$gt: </span><span class="nx">now</span> <span class="p">},</span> <span class="nv">owner: </span><span class="kc">null</span> <span class="p">},</span>
        <span class="s1">&#39;expires&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nv">$set: </span><span class="p">{</span> <span class="nx">timeout</span><span class="p">,</span> <span class="nx">owner</span> <span class="p">}</span> <span class="p">},</span> <span class="p">{</span> <span class="k">new</span><span class="o">:</span> <span class="mi">1</span> <span class="p">},</span> <span class="nx">callback</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>After you are done with the job, mark it as completed. This will remove
the job from MongoDB.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">complete: </span><span class="nf">(doc, callback) -&gt;</span>
    <span class="nx">@exec</span> <span class="nf">(mojo) -&gt;</span>
      <span class="nx">mojo</span><span class="p">.</span><span class="nx">findAndModify</span> <span class="p">{</span> <span class="nv">_id: </span><span class="nx">doc</span><span class="p">.</span><span class="nx">_id</span> <span class="p">},</span>
        <span class="s1">&#39;expires&#39;</span><span class="p">,</span> <span class="p">{},</span> <span class="p">{</span> <span class="nv">remove: </span><span class="mi">1</span> <span class="p">},</span> <span class="nx">callback</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>You can also refuse to complete the job and leave it in the database
so that other workers can pick it up.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">release: </span><span class="nf">(doc, callback) -&gt;</span>
    <span class="nx">@exec</span> <span class="nf">(mojo) -&gt;</span>
      <span class="nx">mojo</span><span class="p">.</span><span class="nx">findAndModify</span> <span class="p">{</span> <span class="nv">_id: </span><span class="nx">doc</span><span class="p">.</span><span class="nx">_id</span> <span class="p">},</span>
        <span class="s1">&#39;expires&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nv">$unset: </span><span class="p">{</span> <span class="nv">timeout: </span><span class="mi">1</span><span class="p">,</span> <span class="nv">owner: </span><span class="mi">1</span> <span class="p">}</span> <span class="p">},</span> <span class="p">{</span> <span class="k">new</span><span class="o">:</span> <span class="mi">1</span> <span class="p">},</span> <span class="nx">callback</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Release all timed out jobs, this makes them available for future
clients again. You should call this method regularly, possibly from
within the workers after every couple completed jobs.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">cleanup: </span><span class="nf">(callback) -&gt;</span>
    <span class="nx">@exec</span> <span class="nf">(mojo) -&gt;</span>
      <span class="nx">mojo</span><span class="p">.</span><span class="nx">update</span> <span class="p">{</span> <span class="nv">timeout: </span><span class="p">{</span> <span class="nv">$lt: </span><span class="k">new</span> <span class="nb">Date</span> <span class="p">}</span> <span class="p">},</span>
          <span class="p">{</span> <span class="nv">$unset: </span><span class="p">{</span> <span class="nv">timeout: </span><span class="mi">1</span><span class="p">,</span> <span class="nv">owner: </span><span class="mi">1</span> <span class="p">}</span> <span class="p">},</span> <span class="p">{</span> <span class="nv">multi: </span><span class="mi">1</span> <span class="p">},</span> <span class="nx">callback</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <h3>Template</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Extend the <strong>Template</strong> class to define a job. You need to implement the
<code>perform</code> method. That method will be called when there is work to be done.
After you are done with the job, call <code>@complete</code> to signal the worker that
it can process the next job.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">exports</span><span class="p">.</span><span class="nx">Template</span>
  <span class="nv">constructor: </span><span class="nf">(@worker, @doc) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Bind <code>this</code> to this instance in @perform and catch any exceptions.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">invoke: </span><span class="o">-&gt;</span>
    <span class="k">try</span>
      <span class="nx">@perform</span><span class="p">.</span><span class="nx">apply</span> <span class="err">@</span><span class="p">,</span> <span class="nx">@doc</span><span class="p">.</span><span class="nx">args</span>
    <span class="k">catch</span> <span class="nx">err</span>
      <span class="nx">@complete</span> <span class="nx">err</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Implement this method. If you don't, kittens will die!</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">perform: </span><span class="nf">(args...) -&gt;</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span> <span class="s1">&#39;Yo, you need to implement me!&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>As per unwritten standard, first argument in callbacks is an error
indicator. So you can pass this method around as a completion callback.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">complete: </span><span class="nf">(err) -&gt;</span>
    <span class="nx">@worker</span><span class="p">.</span><span class="nx">complete</span> <span class="nx">err</span><span class="p">,</span> <span class="nx">@doc</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <h3>Worker</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>A worker polls for new jobs and executes them.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">exports</span><span class="p">.</span><span class="nx">Worker</span> <span class="k">extends</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;events&#39;</span><span class="p">).</span><span class="nx">EventEmitter</span>
  <span class="nv">constructor: </span><span class="nf">(@connection, @templates, options) -&gt;</span>
    <span class="nx">options</span> <span class="o">or</span> <span class="nv">options = </span><span class="p">{}</span>

    <span class="vi">@name = </span><span class="p">[</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;os&#39;</span><span class="p">).</span><span class="nx">hostname</span><span class="p">(),</span> <span class="nx">process</span><span class="p">.</span><span class="nx">pid</span> <span class="p">].</span><span class="nx">join</span> <span class="s1">&#39;:&#39;</span>
    <span class="vi">@timeout = </span><span class="nx">options</span><span class="p">.</span><span class="nx">timeout</span> <span class="o">or</span> <span class="mi">1000</span>

    <span class="vi">@workers = </span><span class="nx">options</span><span class="p">.</span><span class="nx">workers</span> <span class="o">or</span> <span class="mi">3</span>
    <span class="vi">@pending = </span><span class="mi">0</span>


  <span class="nv">poll: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>If there are too many pending jobs, sleep for a bit.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">@pending</span> <span class="o">&gt;=</span> <span class="nx">@workers</span>
      <span class="k">return</span> <span class="nx">@sleep</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Check the templates in round-robin order, one in each iteration.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">template = </span><span class="nx">@templates</span><span class="p">.</span><span class="nx">shift</span><span class="p">()</span>
    <span class="nx">@templates</span><span class="p">.</span><span class="nx">push</span> <span class="nx">template</span>

    <span class="nx">@connection</span><span class="p">.</span><span class="nx">next</span> <span class="nx">template</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="nx">@name</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">doc</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="k">if</span> <span class="nx">err</span><span class="o">?</span>
        <span class="nx">@emit</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="nx">err</span>
      <span class="k">else</span> <span class="k">if</span> <span class="nx">doc</span><span class="o">?</span>
        <span class="o">++</span><span class="nx">@pending</span>
        <span class="k">new</span> <span class="nx">template</span><span class="p">(</span><span class="err">@</span><span class="p">,</span> <span class="nx">doc</span><span class="p">).</span><span class="nx">invoke</span><span class="p">()</span>
        <span class="nx">process</span><span class="p">.</span><span class="nx">nextTick</span> <span class="o">=&gt;</span>
          <span class="nx">@poll</span><span class="p">()</span>

      <span class="nx">@sleep</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>Sleep for a bit and then try to poll the queue again. If a timeout is
already active make sure to clear it first.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">sleep: </span><span class="o">-&gt;</span>
    <span class="nx">clearTimeout</span> <span class="nx">@pollTimeout</span> <span class="k">if</span> <span class="nx">@pollTimeout</span>
    <span class="vi">@pollTimeout = </span><span class="nx">setTimeout</span> <span class="o">=&gt;</span>
      <span class="vi">@pollTimeout = </span><span class="kc">null</span>
      <span class="nx">@poll</span><span class="p">()</span>
    <span class="p">,</span> <span class="nx">@timeout</span>


  <span class="nv">complete: </span><span class="nf">(err, doc) -&gt;</span>
    <span class="nv">cb = </span><span class="o">=&gt;</span> <span class="o">--</span><span class="nx">@pending</span><span class="p">;</span> <span class="nx">@poll</span><span class="p">()</span>

    <span class="k">if</span> <span class="nx">err</span><span class="o">?</span>
      <span class="nx">@connection</span><span class="p">.</span><span class="nx">release</span> <span class="nx">doc</span><span class="p">,</span> <span class="nx">cb</span>
    <span class="k">else</span>
      <span class="nx">@connection</span><span class="p">.</span><span class="nx">complete</span> <span class="nx">doc</span><span class="p">,</span> <span class="nx">cb</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 